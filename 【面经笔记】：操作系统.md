# 【面经笔记】：操作系统

## 操作系统引论

### 操作系统的特性：

1. 并发：同一段时间内多个程序执行
2. 共享：系统中的资源可以被内存中多个并发执行的进线程共同使用
3. 虚拟：通过时分复用以及空分复用（如虚拟内存），把一个物理实体虚拟为多个
4. 异步：系统中的进程是以走走停停的方式执行的，且以一种不可预知的速度推进

### 操作系统的主要功能：

1. 进程管理：主要是对处理机进行管理，为了提高CPU的利用率而采用多道程序技术。通过进程管理来协调多道程序之间的关系，使得CPU得到充分利用。
2. 内存管理：适用于多任务系统（例如Windows），在同一时刻可能有多个应用程序共享内存，为了使得某个任务更好的执行，系统可能会对其他任务分配的内存进行移动，甚至删除。
3. 设备管理：管理所有外围设备，包括完成用户IO请求，为用户进程分配IO设备，提高IO设备利用率，提高IO速度，方便IO使用。
4. 文件管理：管理用户文件和系统文件，方便使用的同时保证安全性。包括磁盘存储空间管理，目录管理，文件读写管理以及文件共享及保护。
5. 提供用户接口：程序接口（如API）和用户接口（如GUI）

### 各种操作系统的区别：

1. 批处理操作系统：成批处理，系统吞吐量高，资源利用率高，用户不能干预作业的执行
2. 分时操作系统：多路性，独立性，及时性，交互性
3. 实时操作系统：及时响应，快速处理，高可靠性和安全性，不要求系统资源利用率

## 

## 进程和线程

### 进程和线程的定义，以及它们的区别：

1. 进程是**具有一定独立功能的程序关于某个数据集合上的一次运行活动**，是**系统进行资源分配和调度的一个独立单位**
2. 线程是进程的一个实体，是**CPU调度和分派的基本单位**，它是比进程更小的能独立运行的基本单位
3. 一个进程可以有多个线程，多个线程可以并发运行
4. 线程基本不拥有系统资源，只拥有一些在运行中必不可少的资源，比如程序计数器，寄存器和栈
5. 线程可以与其他线程共享进程所拥有的全部资源
6. 线程可以创建和撤销另一个线程

### 协程

又称微线程，是一种用户态（非特权状态）的轻量级线程

优点：

1. 无需线程上下文切换的开销
2. 无需原子操作锁定以及同步的开销（拥有自己的寄存器上下文和栈，所以也无法使用多核CPU）
3. 方便切换控制流，简化编程模型

**高并发+高扩展性+低成本：很适合用于高并发处理**

缺点：

1. 无法利用多核资源：协程本质上是个单线程，不能同时将单个CPU的多个核用上，协程需要和进程配合才能运行在多CPU上（多核CPU 是多个单核CPU的替代方案，多核CPU减小了体积，同时也减小了功耗，一个单个CPU上的核心只能同时执行一个线程）
2. 进行阻塞操作时会阻塞掉整个程序

### 用户态和核心态

运行在用户态下的程序，只能受限的访问内存，不允许访问外围设备，占用CPU的能力被剥夺，CPU资源可以被其他程序获取。

运行在内核态下的程序，可以访问内存所有数据，包括外围设备。

用户态切换到内核态的三种方式：

1. 系统调用：用户态进程主动要求切换到内核态的一种方式。用户态进程通过系统调用，申请使用操作系统提供的服务，以完成工作
2. 异常：当CPU在执行运行在用户态下的程序时，发生了某些事先不可知的异常，会触发由当前运行进程切换到处理异常的内核相关程序中。因此也就转到了内核态，比如缺页异常。
3. 外围设备终端：外围设备完成用户请求的操作后，会向CPU发送相应的中断信号。此时，CPU会暂停执行下一条即将要执行的指令，转而执行与中断信号对应的处理程序。如果先前主席那个的指令是用户态的程序，那么转换的过程自然就发生了由用户态到内核态的转换。

### 程序和进程的区别

1. 程序是一个静态概念，进程是一个动态概念
2. 程序没有并行特征，而进程有并行特征
3. 程序不会竞争计算机系统资源，而进程是竞争计算机系统资源的基本单位
4. 不同的进程可以包含同一程序，只要该程序所对应的数据集不同，即使用不同数据集的进程才可以执行同一程序

### 多线程共享什么数据

- 进程代码段
- 进程的公有数据
- 进程打开的文件描述符
- 信号的处理器
- 进程的当前目录
- 进程用户ID 与进程组ID

下面是另一种解释：

之前提到的共享数据指的是共享的环境

- 堆：由于堆是在进程空间中开辟出来的，所以理所当然被共享（16位平台上分全局堆和局部堆，局部堆是独享的）
- 全局变量：它是与具体某一函数无关的，所以也与特定线程无关，因此也是共享的
- 静态变量：虽然对于局部变量来说，它在代码中“放”在某一函数中的，但是其存放位置和全局变量一样，存于堆中开辟的.bss 和.data 段，是共享的
- 文件等公共资源：这个是共享的，使用这些公共资源的线程必须同步。





